<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="./style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.7.1/jszip.min.js"></script>
    <title>JustCompress</title>
  </head>
  <body>
    <main>
        <section class="content">
            <form id="upload-form">
                <span class="titleContainer">
                    <h1 class="title">JustCompress</h1>
                    <h2 class="subtitle">Tired of limited image compressors? Don't worry, I've got your back.<br>
                    Free open source image compressor</h2>
                </span>
                <input type="file" id="file" name="files" accept="image/*" multiple style="display: none;" />
                <div class="drop-zone" id="drop-zone">
                    <svg xmlns="http://www.w3.org/2000/svg" width="35" height="35" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="ai ai-CloudUpload"><path d="M12 12v9m0-9l-2.5 2m2.5-2l2.5 2"/><path d="M5.034 9.117A4.002 4.002 0 0 0 6 17h1"/><path d="M15.83 7.138a5.5 5.5 0 0 0-10.796 1.98S5.187 10 5.5 10.5"/><path d="M17 17a5 5 0 1 0-1.17-9.862L14.5 7.5"/></svg>
                    <p class="textImg">Drag & Drop your images here or click to select.</p>
                </div>
                <label for="compression">Select compression type:</label>
                <select id="compression" name="compression">
                    <option value="webp">WEBP</option>
                    <option value="jpeg">JPEG</option>
                    <option value="png">PNG</option>
                    <option value="bmp">BMP</option>
                    <option value="gif">GIF</option>
                    <option value="raw">RAW</option>
                    <option value="tiff">TIFF</option>
                </select>
                <span class="buttonContainer">
                <button type="submit">Get my files compressed!</button>
                <button type="reset" id="resetButton">Start again</button>
                </span>
            </form>
            <footer>
                <p>Developed by <a href="https://github.com/MrRobot4042212" draggable="false">Dalfon_dev</a></p>
                <aside>
                    <a href="https://github.com/MrRobot4042212" draggable="false">
                    <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 24 24" fill="currentColor" stroke-width="2" class="ai ai-GithubFill"><g clip-path="url(#clip0_100_4)"><path fill-rule="evenodd" clip-rule="evenodd" d="M12 0C5.37 0 0 5.37 0 12c0 5.31 3.435 9.795 8.205 11.385.6.105.825-.255.825-.57 0-.285-.015-1.23-.015-2.235-3.015.555-3.795-.735-4.035-1.41-.135-.345-.72-1.41-1.23-1.695-.42-.225-1.02-.78-.015-.795.945-.015 1.62.87 1.845 1.23 1.08 1.815 2.805 1.305 3.495.99.105-.78.42-1.305.765-1.605-2.67-.3-5.46-1.335-5.46-5.925 0-1.305.465-2.385 1.23-3.225-.12-.3-.54-1.53.12-3.18 0 0 1.005-.315 3.3 1.23.96-.27 1.98-.405 3-.405s2.04.135 3 .405c2.295-1.56 3.3-1.23 3.3-1.23.66 1.65.24 2.88.12 3.18.765.84 1.23 1.905 1.23 3.225 0 4.605-2.805 5.625-5.475 5.925.435.375.81 1.095.81 2.22 0 1.605-.015 2.895-.015 3.3 0 .315.225.69.825.57A12.02 12.02 0 0 0 24 12c0-6.63-5.37-12-12-12z"/></g><defs><clipPath id="clip0_100_4"><rect width="24" height="24"/></clipPath></defs></svg>
                    </a>
                    <a href="https://www.instagram.com/dalfon_dev/" draggable="false">
                    <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 24 24" fill="currentColor" stroke-width="2" class="ai ai-InstagramFill"><path fill-rule="evenodd" clip-rule="evenodd" d="M7.465 1.066C8.638 1.012 9.012 1 12 1c2.988 0 3.362.013 4.534.066 1.172.053 1.972.24 2.672.511.733.277 1.398.71 1.948 1.27.56.549.992 1.213 1.268 1.947.272.7.458 1.5.512 2.67C22.988 8.639 23 9.013 23 12c0 2.988-.013 3.362-.066 4.535-.053 1.17-.24 1.97-.512 2.67a5.396 5.396 0 0 1-1.268 1.949c-.55.56-1.215.992-1.948 1.268-.7.272-1.5.458-2.67.512-1.174.054-1.548.066-4.536.066-2.988 0-3.362-.013-4.535-.066-1.17-.053-1.97-.24-2.67-.512a5.397 5.397 0 0 1-1.949-1.268 5.392 5.392 0 0 1-1.269-1.948c-.271-.7-.457-1.5-.511-2.67C1.012 15.361 1 14.987 1 12c0-2.988.013-3.362.066-4.534.053-1.172.24-1.972.511-2.672a5.396 5.396 0 0 1 1.27-1.948 5.392 5.392 0 0 1 1.947-1.269c.7-.271 1.5-.457 2.67-.511zm8.98 1.98c-1.16-.053-1.508-.064-4.445-.064-2.937 0-3.285.011-4.445.064-1.073.049-1.655.228-2.043.379-.513.2-.88.437-1.265.822a3.412 3.412 0 0 0-.822 1.265c-.151.388-.33.97-.379 2.043-.053 1.16-.064 1.508-.064 4.445 0 2.937.011 3.285.064 4.445.049 1.073.228 1.655.379 2.043.176.477.457.91.822 1.265.355.365.788.646 1.265.822.388.151.97.33 2.043.379 1.16.053 1.507.064 4.445.064 2.938 0 3.285-.011 4.445-.064 1.073-.049 1.655-.228 2.043-.379.513-.2.88-.437 1.265-.822.365-.355.646-.788.822-1.265.151-.388.33-.97.379-2.043.053-1.16.064-1.508.064-4.445 0-2.937-.011-3.285-.064-4.445-.049-1.073-.228-1.655-.379-2.043-.2-.513-.437-.88-.822-1.265a3.413 3.413 0 0 0-1.265-.822c-.388-.151-.97-.33-2.043-.379zm-5.85 12.345a3.669 3.669 0 0 0 4-5.986 3.67 3.67 0 1 0-4 5.986zM8.002 8.002a5.654 5.654 0 1 1 7.996 7.996 5.654 5.654 0 0 1-7.996-7.996zm10.906-.814a1.337 1.337 0 1 0-1.89-1.89 1.337 1.337 0 0 0 1.89 1.89z"/></svg>
                    </a>
                </aside>
            </footer>
        </section>
        <section class="slider_container">
            <img class="slide" src="/1.webp" alt="foto de una luna azul" draggable="false">
        </section>
    </main>



    <script>
      const dropZone = document.getElementById('drop-zone');
      const fileInput = document.getElementById('file');
      const form = document.getElementById('upload-form');
      const resetButton = document.getElementById('resetButton');
      let droppedFiles = [];

      dropZone.addEventListener('click', () => fileInput.click());

      fileInput.addEventListener('change', (e) => {
          handleFiles(e.target.files);
      });

      dropZone.addEventListener('dragover', (e) => {
          e.preventDefault();
          dropZone.classList.add('dragover');
      });

      dropZone.addEventListener('dragleave', () => {
          dropZone.classList.remove('dragover');
      });

      dropZone.addEventListener('drop', (e) => {
          e.preventDefault();
          dropZone.classList.remove('dragover');
          handleFiles(e.dataTransfer.files);
      });

      resetButton.addEventListener('click', () => {
          dropZone.innerHTML = 'Drag & Drop your images here or click to select';
          droppedFiles = [];
      });

      function handleFiles(files) {
          dropZone.innerHTML = '';
          droppedFiles = files;
          Array.from(files).forEach(file => {
              if (file && file.type.startsWith('image/')) {
                  const reader = new FileReader();
                  reader.onload = (e) => {
                      const img = document.createElement('img');
                      img.src = e.target.result;
                      dropZone.appendChild(img);
                  };
                  reader.readAsDataURL(file);
              } else {
                  alert('Please upload a valid image file.');
              }
          });
      }

      form.addEventListener('submit', async (e) => {
          e.preventDefault();
          const files = droppedFiles.length ? droppedFiles : fileInput.files;
          const compressionType = document.getElementById('compression').value;
          const compressedFiles = await compressImages(files, compressionType);
          downloadCompressedFiles(compressedFiles);
      });

      async function compressImages(files, compressionType) {
          const compressedFiles = [];
          for (const file of files) {
              const compressedFile = await compressImage(file, compressionType);
              compressedFiles.push(compressedFile);
          }
          return compressedFiles;
      }

      function compressImage(file, compressionType) {
          return new Promise((resolve, reject) => {
              const reader = new FileReader();
              reader.onload = (e) => {
                  const img = new Image();
                  img.onload = () => {
                      const canvas = document.createElement('canvas');
                      const ctx = canvas.getContext('2d');
                      canvas.width = img.width;
                      canvas.height = img.height;
                      ctx.drawImage(img, 0, 0);
                      let mimeType;
                      switch (compressionType) {
                          case 'webp':
                              mimeType = 'image/webp';
                              break;
                          case 'jpeg':
                              mimeType = 'image/jpeg';
                              break;
                          case 'png':
                              mimeType = 'image/png';
                              break;
                          case 'bmp':
                              mimeType = 'image/bmp';
                              break;
                          case 'gif':
                              mimeType = 'image/gif';
                              break;
                          case 'raw':
                              mimeType = 'image/raw';
                              break;
                          case 'tiff':
                              mimeType = 'image/tiff';
                              break;
                          default:
                              mimeType = 'image/png';
                      }
                      canvas.toBlob((blob) => {
                          const compressedFile = new File([blob], file.name.replace(/\.[^/.]+$/, `.${compressionType}`), {
                              type: mimeType
                          });
                          resolve(compressedFile);
                      }, mimeType);
                  };
                  img.src = e.target.result;
              };
              reader.readAsDataURL(file);
          });
      }

      async function downloadCompressedFiles(files) {
          const zip = new JSZip();
          const imgFolder = zip.folder("images");
          if (!files.length) {
              alert('No files to download.');
              return;
          }
          for (const file of files) {
              const arrayBuffer = await file.arrayBuffer();
              imgFolder.file(file.name, arrayBuffer);
          }

          zip.generateAsync({ type: "blob" }).then((content) => {
              const url = window.URL.createObjectURL(content);
              const a = document.createElement('a');
              a.style.display = 'none';
              a.href = url;
              a.download = 'compressed_images.zip';
              document.body.appendChild(a);
              a.click();
              window.URL.revokeObjectURL(url);
          });
      }
    </script>
  </body>
</html>